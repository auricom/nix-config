{ config, lib, ... }:
let
  cfg = config.my.home.fish;
in
{
  options.my.home.fish = with lib; {
    enable = mkEnableOption "fish configuration";
  };

  config = lib.mkIf cfg.enable {
    home.sessionVariables = {
      KUBECONFIG = "/etc/agenix/kubeconfig";
    };

    programs.fish. = {
      enable = true;

      shellAbbrs = {
        # Github
        gd = "git diff -M";
        ga = "git add";
        gaa = "git add --all .";
        gbd = "git branch -D";
        gs = "git status";
        gca = "git commit -a -m";
        gm = "git merge --no-ff";
        gpt = "git push --tags";
        gp = "git push";
        grh = "git reset --hard";
        gb = "git branch";
        gcob = "git checkout -b";
        gco = "git checkout";
        gba = "git branch -a";
        gcp = "git cherry-pick";
        gl = "git log --pretty=format:\"%Cgreen%h%Creset - %Cblue%an%Creset @ %ar : %s\"";
        gl2 = "git log --pretty='format:%Cgreen%h%Creset %an - %s' --graph";
        glv = "git log --stat";
        gpom = "git pull origin master";
        gcd = "cd \"`git rev-parse --show-toplevel`\"";
        # Nix
        nd = "nixos-rebuild switch --flake . --use-remote-sudo";
        nbug = "nixos-rebuild switch --flake . --use-remote-sudo --show-trace --verbose";
        nu = "nix flake update";
        nh = "nix profile history --profile /nix/var/nix/profiles/system";
        ngc = "sudo nix profile wipe-history --profile /nix/var/nix/profiles/system  --older-than 7d";
        ngcf = "sudo nix store gc --debug";
      };

      shellAliases = {
        l = "lsd -alh";
        ls = "lsd";
        ll = "lsd -l";
        cat = "bat --pager=never";
        vi = "nvim";
        vim = "nvim";
      };
    };

    environment.systemPackages = [
      pkgs.fishPlugins.forgit
      pkgs.fishPlugins.fzf-fish
      pkgs.fishPlugins.pisces
      pkgs.fishPlugins.sponge
      pkgs.fishPlugins.z
    ];

    programs.starship = {
      enable = true;
      # custom settings
      settings = {
      };
    };
  };
}